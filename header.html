<header class="w3s-header" id="mainHeader">
    <button id="sidebarToggleBtn" class="w3s-sidebar-toggle" title="Alternar Menu" aria-label="Alternar Menu">‚ò∞</button>
    <div class="w3s-logo-area">
        <a href="index.html" title="P√°gina Inicial" class="logo-link">
            <svg class="w3s-logo-placeholder" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                <circle cx="20" cy="20" r="18" fill="var(--main-color, #007bff)"/>
                <text x="50%" y="53%" dominant-baseline="middle" text-anchor="middle" fill="white" font-size="16" font-weight="bold" dy=".1em">P</text>
            </svg>
            <span class="logo-text">PRO Concursos</span>
        </a>
    </div>
    
    <nav class="w3s-nav-menu" id="topNav">
        <div class="nav-item">
            <button class="nav-button" data-target="cursos-menu">Cursos ‚ñº</button>
        </div>
        <div class="nav-item">
            <button class="nav-button" data-target="questoes-menu">Quest√µes ‚ñº</button>
        </div>
        <div class="nav-item">
            <button class="nav-button" data-target="flashcards-menu">Flashcards ‚ñº</button>
        </div>
    </nav>
    
    <div class="w3s-header-right-group">
        <div class="w3s-search-area">
            <input type="text" placeholder="Buscar..." aria-label="Campo de busca">
            <button type="submit" aria-label="Buscar">üîç</button>
        </div>
        
        // Dentro do <script> no final do seu header.html, DENTRO de document.addEventListener('DOMContentLoaded', function() { ... });

// Dentro do <script> no final do seu header.html, DENTRO de document.addEventListener('DOMContentLoaded', function() { ... });

// Pomodoro do Header - In√≠cio
const pomodoroBtnHeader = document.getElementById('pomodoro-header-btn');
const pomodoroDropdownHeader = document.getElementById('pomodoro-header-dropdown');
const startPomodoroBtnHeader = document.getElementById('startPomodoroHeaderBtn');
const stopPomodoroBtnHeader = document.getElementById('stopPomodoroHeaderBtn');
const pomodoroTimeSelectHeader = document.getElementById('pomodoroTimeHeader');
const pomodoroTimerDisplayHeader = document.getElementById('pomodoroTimerHeader');
const pomodoroStatusDisplayHeader = document.getElementById('pomodoroStatusHeader');

let pomodoroIntervalInstanceHeader = null;
let timeRemainingValueHeader;
let isBreakStateHeader = false;
let initialFocusDurationHeader;

// Inicializa o display com o valor do select, se os elementos existirem
if (pomodoroTimeSelectHeader && pomodoroTimerDisplayHeader) {
    try {
        timeRemainingValueHeader = parseInt(pomodoroTimeSelectHeader.value) * 60;
        initialFocusDurationHeader = timeRemainingValueHeader;
        pomodoroTimerDisplayHeader.textContent = formatTimeHeaderInternal(timeRemainingValueHeader);
        if (pomodoroStatusDisplayHeader) pomodoroStatusDisplayHeader.textContent = "Foco";
    } catch (e) {
        console.error("Pomodoro (Header): Erro na inicializa√ß√£o dos valores de tempo.", e);
        // Define valores padr√£o em caso de erro para evitar que o resto quebre
        timeRemainingValueHeader = 25 * 60;
        initialFocusDurationHeader = 25 * 60;
        if(pomodoroTimerDisplayHeader) pomodoroTimerDisplayHeader.textContent = formatTimeHeaderInternal(timeRemainingValueHeader);

    }
} else {
    console.warn("Pomodoro (Header): Elementos de display/select n√£o encontrados na inicializa√ß√£o. O Pomodoro do header pode n√£o funcionar.");
}

if (pomodoroBtnHeader && pomodoroDropdownHeader) {
    pomodoroBtnHeader.addEventListener('click', function(e) {
        e.stopPropagation();
        const isVisible = pomodoroDropdownHeader.style.display === 'block';
        // Assumindo que voc√™ tem uma fun√ß√£o closeAllHeaderDropdowns() no escopo do header.html
        if (typeof closeAllHeaderDropdowns === 'function') {
            closeAllHeaderDropdowns(); 
        } else {
            console.warn("Fun√ß√£o closeAllHeaderDropdowns n√£o definida no escopo do header.html");
            // Fallback simples para outros dropdowns conhecidos
            const musicDropdown = document.getElementById('music-header-dropdown');
            if (musicDropdown) musicDropdown.style.display = 'none';
            const loginDropdown = document.getElementById('login-dropdown');
            if (loginDropdown) loginDropdown.style.display = 'none';
            const signupDropdown = document.getElementById('signup-dropdown');
            if (signupDropdown) signupDropdown.style.display = 'none';
        }
        if (!isVisible) pomodoroDropdownHeader.style.display = 'block';
    });
}

if (startPomodoroBtnHeader) {
    startPomodoroBtnHeader.addEventListener('click', () => {
        console.log("Pomodoro (Header): Bot√£o Iniciar clicado.");
        handleStartPomodoroHeader();
    });
}
if (stopPomodoroBtnHeader) {
    stopPomodoroBtnHeader.addEventListener('click', () => {
        console.log("Pomodoro (Header): Bot√£o Parar clicado.");
        handleStopPomodoroHeader();
    });
}

if (pomodoroTimeSelectHeader) {
    pomodoroTimeSelectHeader.addEventListener('change', () => {
        if (!pomodoroIntervalInstanceHeader) { // S√≥ atualiza se estiver parado
            console.log("Pomodoro (Header): Tempo alterado no select.");
            if (!pomodoroTimeSelectHeader || !pomodoroTimerDisplayHeader || !pomodoroStatusDisplayHeader) {
                 console.warn("Pomodoro (Header): Elementos n√£o encontrados ao tentar atualizar pelo select.");
                 return;
            }
            timeRemainingValueHeader = parseInt(pomodoroTimeSelectHeader.value) * 60;
            initialFocusDurationHeader = timeRemainingValueHeader;
            isBreakStateHeader = pomodoroTimeSelectHeader.value !== '25'; // Atualiza estado de pausa
            pomodoroTimerDisplayHeader.textContent = formatTimeHeaderInternal(timeRemainingValueHeader);
            pomodoroStatusDisplayHeader.textContent = isBreakStateHeader ? 'Pausa' : 'Foco';
        }
    });
}

function formatTimeHeaderInternal(seconds) { // Renomeada para evitar conflito global se este script vazar
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function handleStartPomodoroHeader() {
    if (pomodoroIntervalInstanceHeader) {
        console.log("Pomodoro (Header): Timer j√° est√° rodando.");
        return;
    }
    // Re-verificar elementos no momento do clique
    const currentSelect = document.getElementById('pomodoroTimeHeader');
    const currentDisplay = document.getElementById('pomodoroTimerHeader');
    const currentStatus = document.getElementById('pomodoroStatusHeader');

    if (!currentSelect || !currentDisplay || !currentStatus) {
        console.error("Pomodoro (Header): Elementos cruciais n√£o encontrados para iniciar.");
        return;
    }
    console.log("Pomodoro (Header): Iniciando timer...");
    timeRemainingValueHeader = parseInt(currentSelect.value) * 60;
    initialFocusDurationHeader = timeRemainingValueHeader;
    isBreakStateHeader = currentSelect.value !== '25';
    currentStatus.textContent = isBreakStateHeader ? 'Pausa' : 'Foco';
    currentDisplay.textContent = formatTimeHeaderInternal(timeRemainingValueHeader);
    pomodoroIntervalInstanceHeader = setInterval(handleUpdatePomodoroTimerHeader, 1000);
}

function handleUpdatePomodoroTimerHeader() {
    // Re-verificar elementos no momento da atualiza√ß√£o
    const currentDisplay = document.getElementById('pomodoroTimerHeader');
    const currentStatus = document.getElementById('pomodoroStatusHeader');

    if (!currentDisplay || !currentStatus) {
        console.error("Pomodoro (Header): Elementos de display n√£o encontrados durante atualiza√ß√£o. Parando timer.");
        clearInterval(pomodoroIntervalInstanceHeader);
        pomodoroIntervalInstanceHeader = null;
        return;
    }

    if (timeRemainingValueHeader <= 0) {
        console.log("Pomodoro (Header): Ciclo conclu√≠do.");
        clearInterval(pomodoroIntervalInstanceHeader);
        pomodoroIntervalInstanceHeader = null;
        currentStatus.textContent = 'Conclu√≠do!';
        // Notifica√ß√£o sonora aqui (opcional)
        // Ex: const audio = new Audio('caminho/para/som.mp3'); audio.play();
        setTimeout(() => {
            timeRemainingValueHeader = initialFocusDurationHeader; 
            currentDisplay.textContent = formatTimeHeaderInternal(timeRemainingValueHeader);
            currentStatus.textContent = isBreakStateHeader ? 'Pausa' : 'Foco';
            console.log("Pomodoro (Header): Timer resetado para pr√≥ximo ciclo.");
        }, 3000);
        return;
    }
    timeRemainingValueHeader--;
    currentDisplay.textContent = formatTimeHeaderInternal(timeRemainingValueHeader);
}

function handleStopPomodoroHeader() {
    console.log("Pomodoro (Header): Parando timer.");
    clearInterval(pomodoroIntervalInstanceHeader);
    pomodoroIntervalInstanceHeader = null;

    const currentSelect = document.getElementById('pomodoroTimeHeader');
    const currentDisplay = document.getElementById('pomodoroTimerHeader');
    const currentStatus = document.getElementById('pomodoroStatusHeader');

    if (currentSelect && currentDisplay) {
        timeRemainingValueHeader = parseInt(currentSelect.value) * 60;
        currentDisplay.textContent = formatTimeHeaderInternal(timeRemainingValueHeader);
    }
    if (currentStatus) currentStatus.textContent = 'Foco';
}
// Pomodoro do Header - Fim            

        <div class="w3s-header-actions">
            <button id="pomodoro-header-btn" class="header-tool-btn" title="Pomodoro"><span class="icon">üçÖ</span></button>
            <div id="pomodoro-header-dropdown" class="header-dropdown">
                <h4>Timer Pomodoro</h4>
                <select id="pomodoroTimeHeader">
                    <option value="25">25 minutos (Foco)</option>
                    <option value="5">5 minutos (Pausa)</option>
                    <option value="15">15 minutos (Pausa Longa)</option>
                </select>
                <div class="dropdown-buttons">
                    <button id="startPomodoroHeaderBtn">Iniciar</button>
                    <button id="stopPomodoroHeaderBtn">Parar</button>
                </div>
                <div id="pomodoroTimerHeader" class="timer-display">25:00</div>
                <p id="pomodoroStatusHeader" class="status-display">Foco</p>
            </div>

            <button id="music-header-btn" class="header-tool-btn" title="M√∫sica"><span class="icon">üéµ</span></button>
            <div id="music-header-dropdown" class="header-dropdown">
                <h4>M√∫sica de Fundo</h4>
                <p>Escolha uma m√∫sica para relaxar:</p>
                <div class="dropdown-buttons">
                    <button id="playMusicHeaderBtn">Tocar</button>
                    <button id="pauseMusicHeaderBtn">Pausar</button>
                </div>
                <audio id="audioPlayerHeader" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>
            </div>

            <button id="theme-toggle" title="Alternar Tema Claro/Escuro">
                <span class="icon theme-icon-light">‚òÄÔ∏è</span>
                <span class="icon theme-icon-dark" style="display: none;">üåô</span>
            </button>
            <button id="color-picker-btn" title="Mudar Cor de Fundo"><span class="icon">üé®</span> <span class="link-text">Cor</span></button>
            <a href="#" title="Assinaturas"><span class="icon">‚ûï</span> <span class="link-text">Assinaturas</span></a>
            <a href="#" title="Contato"><span class="icon">üë®‚Äçüè´</span> <span class="link-text">Contato</span></a>
            
            <button id="logout-btn" title="Logout" style="display: none;"><span class="icon">üö™</span> <span class="link-text">Logout</span></button>

            <div class="login-container">
                <button id="login-btn" title="Login"><span class="icon">üë§</span> <span class="link-text">Login</span></button>
                <div id="login-dropdown" class="login-dropdown-panel">
                    <form id="login-form">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" name="email" required>
                        <label for="login-password">Senha:</label>
                        <input type="password" id="login-password" name="password" required>
                        <button type="submit">Entrar</button>
                        <p>N√£o tem conta? <a href="#" id="show-signup">Cadastre-se</a></p>
                    </form>
                </div>
                <div id="signup-dropdown" class="login-dropdown-panel" style="display: none;">
                    <form id="signup-form">
                        <label for="signup-email">Email:</label>
                        <input type="email" id="signup-email" name="email" required>
                        <label for="signup-password">Senha:</label>
                        <input type="password" id="signup-password" name="password" required>
                        <label for="confirm-password">Confirmar Senha:</label>
                        <input type="password" id="confirm-password" name="confirmPassword" required>
                        <button type="submit">Cadastrar</button>
                        <p>J√° tem conta? <a href="#" id="show-login">Fa√ßa Login</a></p>
                    </form>
                </div>
            </div>
        </div>
    </div>
</header>

<div id="megaMenuContainer">
    <div class="mega-menu-panel" id="cursos-menu">
        <div class="mega-menu-column">
            <h4>Direito</h4>
            <a href="#">Direito Constitucional</a>
            <a href="#">Direito Administrativo</a>
            <a href="#">Direito Penal</a>
            <a href="#">Direito Civil</a>
        </div>
        <div class="mega-menu-column">
            <h4>Matem√°tica</h4>
            <a href="#">Matem√°tica B√°sica</a>
            <a href="#">Racioc√≠nio L√≥gico</a>
            <a href="#">Estat√≠stica</a>
            <a href="#">Matem√°tica Financeira</a>
        </div>
        <div class="mega-menu-column">
            <h4>Portugu√™s</h4>
            <a href="#">Gram√°tica</a>
            <a href="#">Interpreta√ß√£o de Texto</a>
            <a href="#">Reda√ß√£o Oficial</a>
            <a href="#">Literatura</a>
        </div>
        <div class="mega-menu-column">
            <h4>Inform√°tica</h4>
            <a href="#">Inform√°tica B√°sica</a>
            <a href="#">Sistemas Operacionais</a>
            <a href="#">Redes de Computadores</a>
            <a href="#">Seguran√ßa da Informa√ß√£o</a>
        </div>
    </div>
    <div class="mega-menu-panel" id="questoes-menu">
        <div class="mega-menu-column">
            <h4>Por Disciplina</h4>
            <a href="#">Direito Constitucional</a>
            <a href="#">Matem√°tica B√°sica</a>
            <a href="#">Portugu√™s</a>
            <a href="#">Inform√°tica</a>
        </div>
        <div class="mega-menu-column">
            <h4>Por Concurso</h4>
            <a href="#">Pol√≠cia Federal</a>
            <a href="#">INSS</a>
            <a href="#">Receita Federal</a>
            <a href="#">Tribunais</a>
        </div>
    </div>
    <div class="mega-menu-panel" id="flashcards-menu">
        <div class="mega-menu-column">
            <h4>Por Disciplina</h4>
            <a href="#">Direito Constitucional</a>
            <a href="#">Matem√°tica B√°sica</a>
            <a href="#">Portugu√™s</a>
            <a href="#">Inform√°tica</a>
        </div>
        <div class="mega-menu-column">
            <h4>Por Concurso</h4>
            <a href="#">Pol√≠cia Federal</a>
            <a href="#">INSS</a>
            <a href="#">Receita Federal</a>
            <a href="#">Tribunais</a>
        </div>
    </div>
</div>

<style>
    /* Estilos Globais do Header (usa vari√°veis da p√°gina principal) */
    .w3s-header {
        background-color: var(--header-bg, #ffffff);
        color: var(--text-dark, #333);
        display: flex;
        align-items: center;
        padding: 0 15px;
        height: var(--header-height, 55px);
        width: 100%;
        position: fixed; /* Mant√©m o header fixo */
        top: 0;
        left: 0;
        z-index: 105; /* Garante que fique acima de outros elementos */
        border-bottom: 1px solid var(--header-border, #e7e7e7);
        gap: 15px;
    }
    
    .w3s-sidebar-toggle {
        background-color: transparent; border: none; font-size: 24px; cursor: pointer;
        padding: 0 10px; color: var(--text-dark, #333); line-height: var(--header-height, 55px);
        transition: color 0.3s;
    }
    .w3s-sidebar-toggle:hover { color: var(--main-color, #1A5276); }
    
    .w3s-logo-area { display: flex; align-items: center; flex-shrink: 0; }
    .logo-link { display: flex; align-items: center; text-decoration: none; color: var(--text-dark, #333); }
    .w3s-logo-placeholder { width: 35px; height: 35px; margin-right: 8px; }
    .logo-text { font-weight: bold; font-size: 18px; color: var(--text-dark); }
    body.dark-mode .logo-text { color: var(--text-light); }

    .w3s-nav-menu { display: flex; align-items: center; height: 100%; }
    .nav-item { height: 100%; }
    .nav-button {
        display: flex; align-items: center; padding: 0 15px; height: 100%;
        color: var(--top-nav-link-color, #333); font-size: 15px; background-color: transparent;
        border: none; border-right: 1px solid var(--header-border, #e7e7e7); cursor: pointer;
        transition: background-color 0.2s;
    }
    .nav-item:first-child .nav-button { border-left: 1px solid var(--header-border, #e7e7e7); }
    .nav-button:hover { background-color: var(--top-nav-link-hover-bg, #f1f1f1); }
    .nav-button.active { background-color: var(--top-nav-link-active-bg, #ddd); }
    
    .w3s-search-area { display: flex; align-items: center; max-width: 200px; }
    .w3s-search-area input[type="text"] {
        padding: 7px 10px; border: 1px solid var(--border-color, #ccc); border-radius: 20px 0 0 20px;
        font-size: 14px; width: 100%; border-right: none; height: 34px;
        background-color: var(--main-content-bg, #ffffff); color: var(--text-dark, #333);
    }
    body.dark-mode .w3s-search-area input[type="text"] {
        background-color: var(--dark-bg, #0d1117); color: var(--text-light, #e6edf3); border-color: var(--header-border);
    }
    .w3s-search-area input[type="text"]:focus { outline: none; border-color: var(--main-color, #1A5276); }
    .w3s-search-area button {
        padding: 0 10px; height: 34px; background-color: var(--light-grey-bg, #f1f1f1);
        border: 1px solid var(--border-color, #ccc); border-left: none; cursor: pointer;
        border-radius: 0 20px 20px 0; font-size: 15px; color: var(--text-muted, #6c757d);
    }
    body.dark-mode .w3s-search-area button {
        background-color: var(--subnav-bg, #22272e); border-color: var(--header-border); color: var(--text-muted);
    }

    .w3s-header-right-group { display: flex; align-items: center; margin-left: auto; gap: 8px; }
    .w3s-header-actions { display: flex; align-items: center; gap: 8px; }
    .w3s-header-actions a, .w3s-header-actions button, .header-tool-btn {
        color: var(--text-dark, #333); text-decoration: none; font-size: 14px;
        display: flex; align-items: center; gap: 5px; padding: 6px 8px;
        border-radius: 4px; background: none; border: none; cursor: pointer;
        white-space: nowrap; transition: background-color 0.2s, color 0.2s;
    }
    body.dark-mode .w3s-header-actions a, body.dark-mode .w3s-header-actions button, body.dark-mode .header-tool-btn {
        color: var(--text-light);
    }
    .w3s-header-actions a .icon, .w3s-header-actions button .icon, .header-tool-btn .icon { font-size: 1.2em; }
    .w3s-header-actions a:hover, .w3s-header-actions button:hover, .header-tool-btn:hover {
        color: var(--main-color, #1A5276);
        background-color: var(--top-nav-link-hover-bg, rgba(0,0,0,0.03));
    }
    body.dark-mode .w3s-header-actions a:hover, body.dark-mode .w3s-header-actions button:hover, body.dark-mode .header-tool-btn:hover {
        background-color: var(--top-nav-link-hover-bg);
    }

    .header-dropdown {
        display: none; position: absolute; top: calc(var(--header-height, 55px) - 5px);
        right: 10px; background-color: var(--main-content-bg); color: var(--text-dark);
        border: 1px solid var(--border-color); border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.15); padding: 18px 22px;
        z-index: 200; min-width: 240px;
    }
    body.dark-mode .header-dropdown {
        background-color: var(--dark-bg); color: var(--text-light); border-color: var(--header-border);
    }
    .header-dropdown h4 { margin: 0 0 12px 0; color: var(--main-color); font-size: 1.1em; }
    .header-dropdown select, .header-dropdown p { width: 100%; margin-bottom: 12px; font-size: 0.95em; }
    .header-dropdown select {
        padding: 8px; border: 1px solid var(--border-color); border-radius: 4px;
        background-color: var(--main-content-bg); color: var(--text-dark);
    }
    body.dark-mode .header-dropdown select {
        background-color: var(--subnav-bg); color: var(--text-light); border-color: var(--header-border);
    }
    .header-dropdown .dropdown-buttons { display: flex; gap: 8px; margin-bottom: 10px; }
    .header-dropdown .dropdown-buttons button {
        flex-grow: 1; padding: 8px 10px; border-radius: 4px; border: none;
        cursor: pointer; font-weight: 500; background-color: var(--main-color); color: white;
    }
    .header-dropdown .dropdown-buttons button:hover { opacity: 0.9; }
    .header-dropdown .timer-display { font-size: 1.6em; margin: 12px 0; color: var(--main-color); font-weight: bold; text-align: center; }
    .header-dropdown .status-display { font-size: 0.9em; color: var(--text-muted); text-align: center; margin:0; }

    .login-container { position: relative; }
    .login-dropdown-panel {
        display: none; position: absolute; top: calc(100% + 5px); right: 0;
        background-color: var(--main-content-bg, #ffffff); border: 1px solid var(--border-color, #ccc);
        border-radius: 4px; padding: 20px; z-index: 110; width: 280px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    body.dark-mode .login-dropdown-panel {
        background-color: var(--dark-bg); color: var(--text-light); border-color: var(--header-border);
    }
    .login-dropdown-panel label { display: block; margin-bottom: 6px; font-size: 14px; font-weight: 500; }
    .login-dropdown-panel input[type="email"], .login-dropdown-panel input[type="password"] {
        width: 100%; padding: 9px 12px; margin-bottom: 15px;
        border: 1px solid var(--border-color, #ccc); border-radius: 4px; box-sizing: border-box;
        background-color: var(--main-content-bg); color: var(--text-dark);
    }
    body.dark-mode .login-dropdown-panel input[type="email"], body.dark-mode .login-dropdown-panel input[type="password"] {
        background-color: var(--subnav-bg); color: var(--text-light); border-color: var(--header-border);
    }
    .login-dropdown-panel button[type="submit"] {
        width: 100%; background-color: var(--main-color, #1A5276); color: white;
        border: none; padding: 10px; border-radius: 4px; cursor: pointer;
        font-weight: bold; margin-bottom: 12px; font-size: 15px;
    }
    .login-dropdown-panel p { font-size: 13px; text-align: center; margin: 12px 0 0; color: var(--text-muted); }
    .login-dropdown-panel p a { color: var(--main-color); text-decoration: none; }
    .login-dropdown-panel p a:hover { text-decoration: underline; }
    
    /* --- Mega Menu Panel (agora no header.html) --- */
    .mega-menu-panel {
        display: none; /* Controlado por JS com classe .active na p√°gina principal */
        position: fixed;
        top: var(--header-height); /* Abaixo do header */
        left: 0;
        width: 100%;
        max-height: calc(100vh - var(--header-height));
        overflow-y: auto;
        background-color: var(--mega-menu-bg);
        border-top: 1px solid var(--mega-menu-border);
        box-shadow: var(--mega-menu-shadow);
        z-index: 104; /* Abaixo do header (105), mas acima de outros conte√∫dos */
        padding: 25px 30px;
        box-sizing: border-box;
    }
    /* .active √© adicionada/removida pelo JS da p√°gina principal (initializeHeaderEvents) */
    .mega-menu-panel.active {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    .mega-menu-column { flex: 1; min-width: 200px; padding: 0 15px; }
    .mega-menu-column:not(:last-child) { border-right: 1px solid var(--mega-menu-border); }
    .mega-menu-column h4 { 
        font-size: 1.1em; color: var(--mega-menu-heading-color); 
        margin: 0 0 15px; padding-bottom: 8px; 
        border-bottom: 1px solid var(--mega-menu-border); 
    }
    .mega-menu-column a { 
        display: block; color: var(--mega-menu-link-color); 
        text-decoration: none; padding: 6px 0; font-size: 0.95em; 
        transition: color 0.2s; 
    }
    .mega-menu-column a:hover { color: var(--mega-menu-link-hover-color); }

    /* Responsivo */
    @media (max-width: 992px) {
        .w3s-header-actions .link-text, .logo-text { display: none; }
        .w3s-search-area { display: none; }
        .w3s-header-right-group { gap: 5px; }
        .w3s-header-actions { gap: 5px; }
        .mega-menu-column { min-width: 180px; } /* Mega menu responsivo */
    }
    @media (max-width: 768px) {
        .w3s-nav-menu { display: none; }
        .w3s-header { padding: 0 10px; gap: 10px;}
        .w3s-sidebar-toggle { padding: 0 10px;}
        .mega-menu-panel { padding: 15px; } /* Mega menu responsivo */
        .mega-menu-column { min-width: calc(50% - 20px); border-right: none !important; }
    }
    @media (max-width: 480px) {
        .w3s-header-actions a[title="Assinaturas"],
        .w3s-header-actions a[title="Contato"],
        .w3s-header-actions button[title="Mudar Cor de Fundo"] { display: none; }
        .header-dropdown { min-width: calc(100vw - 40px); right: 5px; top: calc(var(--header-height, 55px) - 2px); }
        .mega-menu-column { min-width: 100%; padding: 0; } /* Mega menu responsivo */
    }
</style>

<script>
// Script interno do header.html (DOMContentLoaded j√° √© garantido ao ser injetado e scripts executados)
// Cache DOM elements
const loginBtn = document.getElementById('login-btn');
const loginDropdownPanel = document.getElementById('login-dropdown');
const signupDropdownPanel = document.getElementById('signup-dropdown');
const showSignupLink = document.getElementById('show-signup');
const showLoginLink = document.getElementById('show-login');
const loginForm = document.getElementById('login-form');
const signupForm = document.getElementById('signup-form');

const pomodoroBtn = document.getElementById('pomodoro-header-btn');
const pomodoroDropdown = document.getElementById('pomodoro-header-dropdown');
const startPomodoroHeaderBtn = document.getElementById('startPomodoroHeaderBtn');
const stopPomodoroHeaderBtn = document.getElementById('stopPomodoroHeaderBtn');
const pomodoroTimeSelect = document.getElementById('pomodoroTimeHeader');
const pomodoroTimerDisplay = document.getElementById('pomodoroTimerHeader');
const pomodoroStatusDisplay = document.getElementById('pomodoroStatusHeader');

const musicBtn = document.getElementById('music-header-btn');
const musicDropdown = document.getElementById('music-header-dropdown');
const playMusicHeaderBtn = document.getElementById('playMusicHeaderBtn');
const pauseMusicHeaderBtn = document.getElementById('pauseMusicHeaderBtn');
const audioPlayer = document.getElementById('audioPlayerHeader');

let pomodoroIntervalHeader = null;
let timeRemainingHeader = parseInt(pomodoroTimeSelect?.value || '25') * 60;
let isBreakHeader = false;
let initialFocusTimeHeader = parseInt(pomodoroTimeSelect?.value || '25') * 60;
let isMusicPlayingHeader = false;

// --- Login/Signup Dropdown Logic ---
if (loginBtn && loginDropdownPanel && signupDropdownPanel) {
    loginBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const isVisible = loginDropdownPanel.style.display === 'block';
        closeAllHeaderDropdowns();
        if (!isVisible) {
            loginDropdownPanel.style.display = 'block';
        }
    });

    if (showSignupLink) {
        showSignupLink.addEventListener('click', function(e) {
            e.preventDefault(); e.stopPropagation();
            closeAllHeaderDropdowns();
            signupDropdownPanel.style.display = 'block';
        });
    }

    if (showLoginLink) {
        showLoginLink.addEventListener('click', function(e) {
            e.preventDefault(); e.stopPropagation();
            closeAllHeaderDropdowns();
            loginDropdownPanel.style.display = 'block';
        });
    }
}

// --- Pomodoro Logic ---
if (pomodoroBtn && pomodoroDropdown && startPomodoroHeaderBtn && stopPomodoroHeaderBtn && pomodoroTimeSelect && pomodoroTimerDisplay && pomodoroStatusDisplay) {
    pomodoroBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const isVisible = pomodoroDropdown.style.display === 'block';
        closeAllHeaderDropdowns();
        if (!isVisible) pomodoroDropdown.style.display = 'block';
    });
    startPomodoroHeaderBtn.addEventListener('click', startPomodoroHeader);
    stopPomodoroHeaderBtn.addEventListener('click', stopPomodoroHeader);
    pomodoroTimeSelect.addEventListener('change', () => {
        if (!pomodoroIntervalHeader) {
            timeRemainingHeader = parseInt(pomodoroTimeSelect.value) * 60;
            initialFocusTimeHeader = timeRemainingHeader;
            isBreakHeader = pomodoroTimeSelect.value !== '25';
            pomodoroTimerDisplay.textContent = formatTimeHeader(timeRemainingHeader);
            pomodoroStatusDisplay.textContent = isBreakHeader ? 'Pausa' : 'Foco';
        }
    });
}

function formatTimeHeader(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function startPomodoroHeader() {
    if (pomodoroIntervalHeader) return;
    timeRemainingHeader = parseInt(pomodoroTimeSelect.value) * 60;
    initialFocusTimeHeader = timeRemainingHeader;
    isBreakHeader = pomodoroTimeSelect.value !== '25';
    pomodoroStatusDisplay.textContent = isBreakHeader ? 'Pausa' : 'Foco';
    pomodoroTimerDisplay.textContent = formatTimeHeader(timeRemainingHeader);
    pomodoroIntervalHeader = setInterval(updatePomodoroTimerHeader, 1000);
}

function updatePomodoroTimerHeader() {
    if (timeRemainingHeader <= 0) {
        clearInterval(pomodoroIntervalHeader);
        pomodoroIntervalHeader = null;
        pomodoroStatusDisplay.textContent = 'Conclu√≠do!';
        setTimeout(() => {
            timeRemainingHeader = initialFocusTimeHeader;
            pomodoroTimerDisplay.textContent = formatTimeHeader(timeRemainingHeader);
            pomodoroStatusDisplay.textContent = isBreakHeader ? 'Pausa' : 'Foco';
        }, 3000);
        return;
    }
    timeRemainingHeader--;
    pomodoroTimerDisplay.textContent = formatTimeHeader(timeRemainingHeader);
}

function stopPomodoroHeader() {
    clearInterval(pomodoroIntervalHeader);
    pomodoroIntervalHeader = null;
    timeRemainingHeader = parseInt(pomodoroTimeSelect.value) * 60;
    pomodoroTimerDisplay.textContent = formatTimeHeader(timeRemainingHeader);
    pomodoroStatusDisplay.textContent = 'Foco';
}

// --- Music Logic ---
if (musicBtn && musicDropdown && playMusicHeaderBtn && pauseMusicHeaderBtn && audioPlayer) {
    musicBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const isVisible = musicDropdown.style.display === 'block';
        closeAllHeaderDropdowns();
        if (!isVisible) musicDropdown.style.display = 'block';
    });
    playMusicHeaderBtn.addEventListener('click', playMusicHeader);
    pauseMusicHeaderBtn.addEventListener('click', pauseMusicHeader);
}

function playMusicHeader() {
    if (!isMusicPlayingHeader && audioPlayer) {
        audioPlayer.play().catch(error => console.error("Erro ao tocar m√∫sica:", error));
        isMusicPlayingHeader = true;
    }
}
function pauseMusicHeader() {
    if (isMusicPlayingHeader && audioPlayer) {
        audioPlayer.pause();
        isMusicPlayingHeader = false;
    }
}

// --- Form Submissions (Placeholder - Firebase logic should use 'auth' from parent page) ---
if (loginForm) {
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        // Ex: if (window.parentPageAuth) window.parentPageAuth.signInWithEmailAndPassword(email, password)...
        console.log('Tentativa de Login com:', email, '(L√≥gica Firebase a ser integrada com a p√°gina principal)');
        if (loginDropdownPanel) loginDropdownPanel.style.display = 'none';
    });
}

if (signupForm) {
    signupForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        if (password !== confirmPassword) { alert('As senhas n√£o coincidem!'); return; }
        console.log('Tentativa de Cadastro com:', email, '(L√≥gica Firebase a ser integrada com a p√°gina principal)');
        if (signupDropdownPanel) signupDropdownPanel.style.display = 'none';
    });
}

function closeAllHeaderDropdowns() {
    if (loginDropdownPanel) loginDropdownPanel.style.display = 'none';
    if (signupDropdownPanel) signupDropdownPanel.style.display = 'none';
    if (pomodoroDropdown) pomodoroDropdown.style.display = 'none';
    if (musicDropdown) musicDropdown.style.display = 'none';
}

// Global click listener for header dropdowns
document.addEventListener('click', function(e) {
    // Check if the click is outside any of the known dropdowns or their toggle buttons
    const isInsideLogin = loginBtn?.contains(e.target) || loginDropdownPanel?.contains(e.target) || signupDropdownPanel?.contains(e.target);
    const isInsidePomodoro = pomodoroBtn?.contains(e.target) || pomodoroDropdown?.contains(e.target);
    const isInsideMusic = musicBtn?.contains(e.target) || musicDropdown?.contains(e.target);

    if (!isInsideLogin && !isInsidePomodoro && !isInsideMusic) {
        closeAllHeaderDropdowns();
    }
});
</script>